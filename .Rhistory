# ========================================================================================
# BCCSS MORTALITY DATA - MENTAL HEALTH PROJECT (HAMA)
# READ DATA (N=5,922 DEATHS)
# DATE: 12 June 2025
# Converted from Stata to R
# ========================================================================================
# ========================================================================================
# TUTORIAL NOTES: GETTING STARTED WITH R
# ========================================================================================
# This script demonstrates how to read, merge, and manipulate data in R.
#
# KEY DIFFERENCES FROM STATA:
# - Stata uses "$data" for global macros; R uses variables or file paths directly
# - Stata's "use" command = R's read_dta() or read.csv()
# - Stata's "merge" command = R's merge() or dplyr's left_join(), inner_join(), etc.
# - Stata's "gen" command = R's <- assignment or mutate()
# - Stata's "label" command = R's factor() with labels or attributes
# - Stata's "." for missing values = R's NA
# ========================================================================================
# -----------------------------------------------------------------------------------------
# STEP 1: LOAD REQUIRED PACKAGES
# -----------------------------------------------------------------------------------------
# In R, you need to load packages (libraries) that contain functions you'll use.
# The 'haven' package reads Stata .dta files
# The 'dplyr' package provides data manipulation functions
# The 'lubridate' package makes working with dates easier
# Install packages if you haven't already (run these once):
# install.packages("haven")
# install.packages("dplyr")
# install.packages("lubridate")
# Load the packages for this session:
library(haven)      # For reading Stata .dta files
library(dplyr)      # For data manipulation (mutate, select, etc.)
library(lubridate)  # For working with dates
# -----------------------------------------------------------------------------------------
# STEP 2: SET UP FILE PATHS
# -----------------------------------------------------------------------------------------
# STATA EQUIVALENT: global data "path/to/data"
# In R, we create variables to store our file paths.
# This makes it easy to change paths in one place if needed.
# IMPORTANT: Update these paths to match your actual folder structure!
data_path <- "D:/DATAWORK/mort3"
temp_path <- "D:/TEMPWORK"
mort_data <- read_dta(file.path(data_path, "BCCSSMort_Apr25.dta"))
# ========================================================================================
# BCCSS MORTALITY DATA - MENTAL HEALTH PROJECT (HAMA)
# READ DATA (N=5,922 DEATHS)
# DATE: 12 June 2025
# Converted from Stata to R
# ========================================================================================
# ========================================================================================
# TUTORIAL NOTES: GETTING STARTED WITH R
# ========================================================================================
# This script demonstrates how to read, merge, and manipulate data in R.
#
# KEY DIFFERENCES FROM STATA:
# - Stata uses "$data" for global macros; R uses variables or file paths directly
# - Stata's "use" command = R's read_dta() or read.csv()
# - Stata's "merge" command = R's merge() or dplyr's left_join(), inner_join(), etc.
# - Stata's "gen" command = R's <- assignment or mutate()
# - Stata's "label" command = R's factor() with labels or attributes
# - Stata's "." for missing values = R's NA
# ========================================================================================
# -----------------------------------------------------------------------------------------
# STEP 1: LOAD REQUIRED PACKAGES
# -----------------------------------------------------------------------------------------
# In R, you need to load packages (libraries) that contain functions you'll use.
# The 'haven' package reads Stata .dta files
# The 'dplyr' package provides data manipulation functions
# The 'lubridate' package makes working with dates easier
# Install packages if you haven't already (run these once):
# install.packages("haven")
# install.packages("dplyr")
# install.packages("lubridate")
# Load the packages for this session:
library(haven)      # For reading Stata .dta files
library(dplyr)      # For data manipulation (mutate, select, etc.)
library(lubridate)  # For working with dates
# -----------------------------------------------------------------------------------------
# STEP 2: SET UP FILE PATHS
# -----------------------------------------------------------------------------------------
# STATA EQUIVALENT: global data "path/to/data"
# In R, we create variables to store our file paths.
# This makes it easy to change paths in one place if needed.
# IMPORTANT: Update these paths to match your actual folder structure!
data_path <- "D:/DATAWORK/mort3"
temp_path <- "D:/TEMPWORK"
# Note: R uses forward slashes (/) or double backslashes (\\) in file paths,
# even on Windows. Single backslashes (\) won't work!
# -----------------------------------------------------------------------------------------
# STEP 3: READ THE MAIN DATA FILE
# -----------------------------------------------------------------------------------------
# STATA COMMAND: use "$data/BCCSSMort_Apr25.dta", clear
# R EQUIVALENT: read_dta()
#
# read_dta() reads Stata .dta files and stores them as a data frame (R's table format)
# The '<-' symbol is R's assignment operator (like '=' in Stata's gen command)
mort_data <- read_dta(file.path(data_path, "BCCSSMort_Apr25.dta"))
# First, remove the problematic packages
remove.packages("readr")
remove.packages("haven")  # Also reinstall haven since it depends on readr
# Restart R session (in RStudio: Session -> Restart R)
# Or use:
.rs.restartR()
# Then reinstall them
install.packages("readr")
# ========================================================================================
# BCCSS MORTALITY DATA - MENTAL HEALTH PROJECT (HAMA)
# READ DATA (N=5,922 DEATHS)
# DATE: 12 June 2025
# Converted from Stata to R
# ========================================================================================
# ========================================================================================
# TUTORIAL NOTES: GETTING STARTED WITH R
# ========================================================================================
# This script demonstrates how to read, merge, and manipulate data in R.
#
# KEY DIFFERENCES FROM STATA:
# - Stata uses "$data" for global macros; R uses variables or file paths directly
# - Stata's "use" command = R's read_dta() or read.csv()
# - Stata's "merge" command = R's merge() or dplyr's left_join(), inner_join(), etc.
# - Stata's "gen" command = R's <- assignment or mutate()
# - Stata's "label" command = R's factor() with labels or attributes
# - Stata's "." for missing values = R's NA
# ========================================================================================
# -----------------------------------------------------------------------------------------
# STEP 1: LOAD REQUIRED PACKAGES
# -----------------------------------------------------------------------------------------
# In R, you need to load packages (libraries) that contain functions you'll use.
# The 'haven' package reads Stata .dta files
# The 'dplyr' package provides data manipulation functions
# The 'lubridate' package makes working with dates easier
# Install packages if you haven't already (run these once):
# install.packages("haven")
# install.packages("dplyr")
# install.packages("lubridate")
# Load the packages for this session:
library(haven)      # For reading Stata .dta files
install.packages("tidyverse")
install.packages("survival")
install.packages("cmprsk")
install.packages("haven")
install.packages("gridExtra")
install.packages("grid")
install.packages("scales")
# Set parameters
xtime <- 70
# ==============================================================================
# FIGURE 1 - CUMULATIVE MORTALITY WITH NUMBER AT RISK TABLE (R VERSION)
# ==============================================================================
# Load required packages
library(tidyverse)
# Load required packages
library(tidyverse)
# Load only essential packages
library(survival)
# ==============================================================================
# FIGURE 1 - CUMULATIVE MORTALITY WITH NUMBER AT RISK TABLE (SIMPLIFIED R VERSION)
# Uses base R and minimal dependencies to avoid package conflicts
# ==============================================================================
# Load only essential packages
library(survival)
source("fix-r-packages.R")
